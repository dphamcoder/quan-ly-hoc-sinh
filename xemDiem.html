<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·∫øt qu·∫£ h·ªçc t·∫≠p</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="test.css">
    <style>
        /* CSS b·ªï sung ƒë·ªÉ highlight ƒëi·ªÉm */
        .score-good { color: #1cc88a; font-weight: 800; } /* ƒêi·ªÉm cao >= 8.0 */
        .score-bad { color: #e74a3b; font-weight: 800; }  /* ƒêi·ªÉm th·∫•p < 5.0 */
        .score-avg { color: #4e73df; font-weight: 800; }  /* ƒêi·ªÉm trung b√¨nh */
    </style>
</head>
<body>

    <button id="toggleSidebar" class="toggle-btn">
        <i class="fas fa-bars"></i>
    </button>

    <div class="container">
        <aside id="sidebar" class="sidebar">
            <div class="teacher-card">
                <div class="avatar"></div>
                <h3 id="userName">ƒêang t·∫£i...</h3> 
                <p id="userCode">...</p>
            </div>
            <nav>
                <button onclick="window.location.href='thong-tin.html'"><i class="fas fa-user"></i> <span>Th√¥ng tin c√° nh√¢n</span></button>
                <button onclick="window.location.href='thoi-khoa-bieu.html'"><i class="fas fa-calendar-alt"></i> <span>Th·ªùi kh√≥a bi·ªÉu</span></button>
                <button class="active" onclick="window.location.href='ket-qua-hoc-tap.html'"><i class="fas fa-chart-line"></i> <span>K·∫øt qu·∫£ h·ªçc t·∫≠p</span></button>
                <button class="logout-btn"><i class="fas fa-sign-out-alt"></i> <span>ƒêƒÉng xu·∫•t</span></button>
            </nav>
        </aside>

        <main id="mainContent" class="content">
            
            <select class="semester-select" id="semesterSelect" onchange="loadData()">
                <option value="hk1">üìÖ H·ªçc k√¨ 1 - 2025/2026</option>
                <option value="hk2">üìÖ H·ªçc k√¨ 2 - 2025/2026</option>
            </select>

            <div class="card card-score">
                
                <div class="table-responsive">
                    <table class="score-table">
                        <thead>
                            <tr>
                                <th style="width: 20%">M√îN H·ªåC</th>
                                <th colspan="3">H·ªá s·ªë 1 (Mi·ªáng/15p) <div class="header-bar"></div></th>
                                <th colspan="2">H·ªá s·ªë 2 (1 Ti·∫øt) <div class="header-bar"></div></th>
                                <th>H·ªá s·ªë 3 (Thi) <div class="header-bar"></div></th>
                                <th>ƒêTB <div class="header-bar" style="background: var(--primary-color)"></div></th>
                            </tr>
                        </thead>
                        <tbody id="scoreTableBody">
                            </tbody>
                    </table>
                </div>

                <div class="score-footer">
                    <div class="score-summary-item">
                        <span>ƒêi·ªÉm trung b√¨nh</span>
                        <input type="text" class="score-input avg-input" id="finalAvg" value="..." readonly>
                    </div>
                    <div class="score-summary-item">
                        <span>H·∫°nh ki·ªÉm</span>
                        <span style="color: #1cc88a; font-weight: bold;">T·ªët</span>
                    </div>
                    <div class="score-summary-item">
                        <span>X·∫øp lo·∫°i</span>
                        <span id="finalRank" style="font-weight: bold;">...</span>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>

        // 1. MOCK DATA: TH√îNG TIN C√ÅN B·ªò
        const currentUser = {
            name: "Nguy·ªÖn VƒÉn Ho",
            code: "MSCB: 456789123JKQ"
        };
        // 1. MOCK DATA: ƒêi·ªÉm s·ªë c√°c m√¥n
        // hs1: m·∫£ng t·ªëi ƒëa 3 ƒëi·ªÉm, hs2: m·∫£ng t·ªëi ƒëa 2 ƒëi·ªÉm, hs3: 1 ƒëi·ªÉm thi
        const mockGrades = {
            "hk1": [
                { name: "To√°n", icon: "fa-calculator", color: "#4e73df", hs1: [8.5, 9.0, null], hs2: [8.0, 8.5], hs3: 9.0 },
                { name: "V·∫≠t L√≠", icon: "fa-atom", color: "#f6c23e", hs1: [4.5, 5.0, 6.0], hs2: [6.0, 5.5], hs3: 5.0 },
                { name: "H√≥a H·ªçc", icon: "fa-flask", color: "#1cc88a", hs1: [9.0, 9.5, null], hs2: [8.5, 9.0], hs3: 9.5 },
                { name: "Sinh H·ªçc", icon: "fa-dna", color: "#20c9a6", hs1: [7.0, 7.5, null], hs2: [7.0, null], hs3: 7.5 },
                { name: "Ng·ªØ VƒÉn", icon: "fa-book", color: "#e74a3b", hs1: [7.0, 7.5, 8.0], hs2: [7.5, 7.0], hs3: 7.0 },
                { name: "L·ªãch S·ª≠", icon: "fa-landmark", color: "#858796", hs1: [8.0, 8.0, null], hs2: [8.5, null], hs3: 8.0 },
                { name: "ƒê·ªãa L√≠", icon: "fa-globe-americas", color: "#36b9cc", hs1: [9.0, null, null], hs2: [8.5, null], hs3: 9.0 },
                { name: "Ti·∫øng Anh", icon: "fa-language", color: "#4e73df", hs1: [9.0, 8.5, 9.0], hs2: [9.0, 8.5], hs3: 8.8 },
                { name: "Tin H·ªçc", icon: "fa-desktop", color: "#5a5c69", hs1: [10, null, null], hs2: [9.5, null], hs3: 9.0 },
                { name: "GDQP", icon: "fa-shield-alt", color: "#1cc88a", hs1: [8.0, null, null], hs2: [null, null], hs3: null }, // M√¥n ch∆∞a c√≥ ƒë·ªß ƒëi·ªÉm
                { name: "Th·ªÉ Ch·∫•t", icon: "fa-running", color: "#fd7e14", hs1: [9.0, null, null], hs2: [null, null], hs3: null }
            ],
            "hk2": [ // D·ªØ li·ªáu gi·∫£ cho h·ªçc k·ª≥ 2 (ƒë·ªÉ test dropdown)
                { name: "To√°n", icon: "fa-calculator", color: "#4e73df", hs1: [6.0, null, null], hs2: [null, null], hs3: null },
                { name: "Ng·ªØ VƒÉn", icon: "fa-book", color: "#e74a3b", hs1: [7.5, null, null], hs2: [null, null], hs3: null }
            ]
        };

        // 2. H√†m t√≠nh ƒëi·ªÉm trung b√¨nh m√¥n
        function calculateSubjectAvg(subject) {
            let totalScore = 0;
            let totalCoeff = 0;

            // C·ªông ƒëi·ªÉm h·ªá s·ªë 1
            subject.hs1.forEach(s => { 
                if(s !== null) { totalScore += s * 1; totalCoeff += 1; }
            });
            // C·ªông ƒëi·ªÉm h·ªá s·ªë 2
            subject.hs2.forEach(s => { 
                if(s !== null) { totalScore += s * 2; totalCoeff += 2; }
            });
            // C·ªông ƒëi·ªÉm h·ªá s·ªë 3 (Thi)
            if(subject.hs3 !== null) {
                totalScore += subject.hs3 * 3; 
                totalCoeff += 3;
            }

            if(totalCoeff === 0) return null;
            return (totalScore / totalCoeff).toFixed(1);
        }

        // 3. H√†m Render B·∫£ng
        function loadData() {
            const semester = document.getElementById('semesterSelect').value;
            const data = mockGrades[semester];
            const tbody = document.getElementById('scoreTableBody');
            
            tbody.innerHTML = '';
            let sumAvg = 0;
            let countSubjects = 0;

            data.forEach(sub => {
                // T√≠nh ƒêTB m√¥n
                const avg = calculateSubjectAvg(sub);
                
                // N·∫øu m√¥n c√≥ ƒëi·ªÉm TB th√¨ c·ªông v√†o t·ªïng ƒë·ªÉ t√≠nh ph·∫©y cu·ªëi k·ª≥
                if(avg !== null) {
                    sumAvg += parseFloat(avg);
                    countSubjects++;
                }

                // T·∫°o d√≤ng HTML
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><i class="fas ${sub.icon}" style="color: ${sub.color}; width: 20px;"></i> ${sub.name}</td>
                    ${createInputCell(sub.hs1[0])}
                    ${createInputCell(sub.hs1[1])}
                    ${createInputCell(sub.hs1[2])}
                    ${createInputCell(sub.hs2[0])}
                    ${createInputCell(sub.hs2[1])}
                    ${createInputCell(sub.hs3)}
                    <td><input type="text" class="score-input score-avg" value="${avg || ''}" readonly></td>
                `;
                tbody.appendChild(row);
            });

            // 4. T√≠nh t·ªïng k·∫øt h·ªçc k·ª≥
            const finalAvgElement = document.getElementById('finalAvg');
            const finalRankElement = document.getElementById('finalRank');

            if(countSubjects > 0) {
                const finalScore = (sumAvg / countSubjects).toFixed(1);
                finalAvgElement.value = finalScore;
                
                // X·∫øp lo·∫°i
                let rank = "Y·∫øu";
                let rankColor = "#e74a3b"; // ƒê·ªè
                
                if (finalScore >= 8.0) { rank = "Gi·ªèi"; rankColor = "#1cc88a"; }
                else if (finalScore >= 6.5) { rank = "Kh√°"; rankColor = "#4e73df"; }
                else if (finalScore >= 5.0) { rank = "Trung B√¨nh"; rankColor = "#f6c23e"; }

                finalRankElement.innerText = rank;
                finalRankElement.style.color = rankColor;
            } else {
                finalAvgElement.value = "...";
                finalRankElement.innerText = "...";
            }
        }

        // Helper: T·∫°o √¥ input v√† t√¥ m√†u
        function createInputCell(score) {
            let cls = "score-input";
            if(score !== null) {
                if(score >= 8.0) cls += " score-good";
                else if(score < 5.0) cls += " score-bad";
            }
            return `<td><input type="text" class="${cls}" value="${score !== null ? score : ''}" readonly></td>`;
        }

        // 3. H√†m t·∫£i th√¥ng tin c√°n b·ªô
        function loadUserProfile() {
            document.getElementById('userName').innerText = currentUser.name;
            document.getElementById('userCode').innerText = currentUser.code;
        }


        // Sidebar Logic (Gi·ªØ nguy√™n t·ª´ code c≈© c·ªßa b·∫°n)
        document.addEventListener('DOMContentLoaded', function() {
            loadData(); // Load d·ªØ li·ªáu khi v√†o trang

            const toggleBtn = document.getElementById('toggleSidebar');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');

            if (toggleBtn && sidebar) {
                const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                if (isCollapsed) {
                    sidebar.classList.add('collapsed');
                    mainContent.classList.add('expanded');
                    toggleBtn.classList.add('moved');
                    toggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                }
                toggleBtn.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                    mainContent.classList.toggle('expanded');
                    toggleBtn.classList.toggle('moved');
                    if (sidebar.classList.contains('collapsed')) {
                        toggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                        localStorage.setItem('sidebarCollapsed', 'true');
                    } else {
                        toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
                        localStorage.setItem('sidebarCollapsed', 'false');
                    }
                });
            }
        });

         window.onload = function() {
            loadUserProfile();
        };

    </script>
</body>
</html>